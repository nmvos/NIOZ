{% extends 'index.html' %} {% block content %} {% load static %}

<div class="fyke-wrapper biotic">
  <!-- View total for week # button-->
  <a
    href="#"
    class="btn btn-primary"
    id="toggleTableBtn"
    style="align-self: flex-start"
  >
    view total for week {{ record.week }}
  </a>

  <!-- Weekdata table-->
  <table
    border="1"
    cellpadding="4"
    class="fyke-table"
    style="display: none"
    id="bioticWeekTable">
    <tbody>
      <tr>
        <td>Catched in week {{record.week}}/{{record.year}}</td>
      </tr>
      <tr>
        <th>Species</th>
        <th>N</th>
        <th>Lengths</th>
      </tr>
      {% for biotic in species_data %}
      <tr>
        <td>{{ biotic.species }}</td>
        <td>{{ biotic.count }}</td>
        <td>{{ biotic.lengths }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="12">No data available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- DataCollection table -->
  <table border="1" cellpadding="4" class="fyke-table">
    <tbody>
      <tr>
        <th>options</th>
        <th>date</th>
        <th>time</th>
        <th>year</th>
        <th>week</th>
        <th>fishingday</th>
        <th>fyke</th>
        <th>duration</th>
        <th>observer</th>
      </tr>
      <tr>
        <td>
          <a class="btn btn-primary" href="{% url 'datacollection' %}">Back</a>
          <a class="btn btn-primary" id="toggleEntryBtn" href="#">entry</a>
        </td>
        <td>{{ record.date }}</td>
        <td>{{ record.time }}</td>
        <td>{{ record.year }}</td>
        <td>{{ record.week }}</td>
        <td>{{ record.fishingday }}</td>
        <td>{{ record.fyke }}</td>
        <td>{{ record.duration }}</td>
        <td>{{ record.observer }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Form table-->
  <form class="fyke-form" method="post" id="biotic-form">
    {% csrf_token %}
    <table
      border="1"
      cellpadding="4"
      class="fyke-table"
      id="bioticEntryTable"
      {% if not form.initial %}
      style="display: none"
      {% endif %}
    >
      <tbody>
        <tr>
          <th>Species</th>
          <th>Subsample</th>
          <th>N.species</th>
          <th>Length</th>
          <th>Est</th>
          <th>Weight</th>
          <th>Collect#</th>
          <th>Remarks</th>
          <th>Options</th>
        </tr>
        <tr>
          <td>
            <div>
              <input type="text" name="search" id="speciesSearch" placeholder="Search species..." autocomplete="off"/>
              <div class="tooltip">
                <div class="info-icon">i</div>
                <div class="tooltiptext">
                  You can search for species here using the Dutch, English, and Latin names, as well as by speciesID
                </div>
              </div>
            </div>
            <div id="searchResults" style="
                position: absolute;
                background: white;
                border: 1px solid #ddd;
                display: none;
              "
            ></div>
            <input type="hidden" name="species" value="{% if form.initial %} {{ biotic_record.species.species_id }}{% endif %}" required />
            <div id="speciesDisplay">
                {% if form.initial %} {{ biotic_record.species.species_id }} - {{ biotic_record.species.nl_name }}{% endif %}
            </div>
          </td>
          <td>
            <input type="text" name="subsample" value="{{ form.subsample.value }}">
          </td>
          <td>
            <input type="text" name="nspecies" value="{{ form.nspecies.value }}">
          </td>
          <td>
            {{ form.totallength }}
          </td>
          <td>
            {{ form.lengthestimate }}
          </td>
          <td>
            {{ form.freshweight }}
          </td>
          <td>
            <input type="hidden" name="collectno"
              value="
              {% if form.initial %}
                {{ biotic_record.collectno }}
              {% else %}
                0
              {% endif %}
              "/>
            <span id="collectDisplay"{% if not form.initial or biotic_record.collectno == 0 %}style="display: none"{% endif %}>
              {{ record.week }} - {% if form.initial and biotic_record.collectno != 0 %}{{ biotic_record.collectno }}{% else %}{{ nth_record }}{% endif %}
            </span>
          </td>
          <td>
            {{ form.remarks }}
          </td>
          <td>
            <button class="btn btn-primary" id="collect">{% if form.initial and biotic_record.collectno != 0 %}un{% endif %}collect</button>
            <button class="btn btn-primary" id="supress">Supress</button>
          </td>
        </tr>
        <tr>
          <td>
            <button class="btn btn-secondary" type="submit">Store</button>
            <button class="btn btn-primary" id="formCancel" type="reset">Cancel</button>

            {% if biotic_record %}
              <button class="btn btn-primary" id="deleteButton" type="button" onclick="confirmDelete()">Delete</button>
              <input type='hidden' name='delete' value="0">
            {% endif %}

            <div id="global-error-message" style="color: red; display: none">
              One or more inputs are invalid.
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </form>

  <!-- BioticData Table -->
  <table border="1" cellpadding="4" class="fyke-table">
    <tbody>
      <tr>
        <th>species</th>
        <th>Subsample</th>
        <th>N.species</th>
        <th>Length</th>
        <th>Est</th>
        <th>Weight</th>
        <th>Collect#</th>
        <th>Remarks</th>
        <th>Options</th>
      </tr>
      {% for biotic in data %}
      <tr>
        <td>{{ biotic.species.species_id }}-{{ biotic.species }}</td>
        <td>{{ biotic.subsample }}</td>
        <td>{{ biotic.nspecies }}</td>
        <td>{{ biotic.totallength }}</td>
        <td style="text-align: center">
          {% if biotic.lengthestimate %}
          <img
            src="{% static 'img\checkmark.webp' %}"
            style="width: 20px; height: 20px"
          />
          {% endif %}
        </td>
        <td>{{ biotic.freshweight }}</td>
        <td>
          {% if biotic.collectno %}
            <a href="{% url 'fishdetails' %}?year={{ biotic.year}}&week={{ biotic.week }}&range=all&collectno={{ biotic.collectno }}" class="btn btn-secondary">
              {{ biotic.week }} - {{ biotic.collectno }}
            </a>
          {% endif %}
        </td>
        <td>{{ biotic.remarks }}</td>
        <td>
          <a class="btn btn-primary" href="{% url 'biotic' record.id %}?biotic={{ biotic.id }}">edit</a>
          <a class="btn btn-primary" style="{% if not biotic.collectno %}display: none{% endif %}" href="#">Label</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="12">No data available.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- template scripts -->
<script>
  var nth_record = {{ nth_record }}
  var record = '{{ biotic_record.id }}'

  function confirmDelete() {
    if (confirm("Are you sure you want to delete this record?")) {
        document.querySelector('input[name="delete"]').value = '1';
        document.getElementById("biotic-form").submit();
    }
}
</script>
<script src="{% static 'js\biotic.js' %}"></script>
{% endblock %}